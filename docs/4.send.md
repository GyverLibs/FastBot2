## Отправка
В данной библиотеке, в отличие от многих других, отправка запроса на сервер Telegram идёт не через query string, а в теле запроса типа application/json. Это означает, что отправляемый текст не должен быть urlencoded и не имеет прочих ограничений, а может отправляться в неизменном виде - это сильно экономит время и ресурс контроллера. Также это избавляет от проблем с отправкой сообщений в стилях HTML и Markdown.

### ID чата и тип Value
В большинстве команд отправки нужен id чата - уникальный номер чата или группы в Telegram. Это число выходит за рамки типа данных `long`, поэтому в библиотеке используется тип данных `Value` ([документация](https://github.com/GyverLibs/StringUtils?tab=readme-ov-file#suvalue)). Он принимает как числа любого типа, так и строки. Таким образом id чата при работе с FastBot2 можно хранить как в строках в любом виде, так и в целочисленной переменной типа `int64_t` (`long long`) - очень удобно для взаимодействия и хренения в энергонезависимой памяти (EEPROM/Flash). Например:
```cpp
su::Value val;
val = "1234567898765";
val = 1234567898765;
```

При разборе обновлений id чата является типом `Text`, который в свою очередь может конвертироваться в `int64_t`:
```cpp
int64_t chat_id;

void update(fb::Update& u) {
    u.message().from().id() == 12345678ll;  // сравнение
    chat_id = u.message().from().id();      // сохранение в переменную
}
```
Поэтому для отправки можно использовать id в любом виде.

### Отправка сообщений
FastBot2 удобно оборачивает почти весь API по отправке сообщения в класс `fb::Message`. Типичный сценарий использования:
- Создать `fb::Message`
- Заполнить обязательные параметры - `text` и `chatID`
- По желанию заполнить другие параметры
- Отправить в `sendMessage`

```cpp
fb::Message msg;
msg.text = "some text";
msg.chatID = 123456677889;  // или в виде строки
bot.sendMessage(msg);
```

Возможна укороченная запись, `Message` имеет конструктор с минимальными обязательными параметрами:
```cpp
bot.sendMessage(fb::Message("hello!", "12312424353"));
```

### Асинхронность и ID сообщения
ID отправленного ботом сообщения можно получить из `lastBotMessage()`. Нужно понимать, что у каждого чата свой счётчик ID сообщений. Библиотека получает ID отправленного сообщения из ответа сервера, поэтому есть несколько важных моментов.

Сообщение может быть отправлено двумя способами:
- **Синхронно** - библиотека ждёт и обрабатывает ответ сервера внутри отправки сообщения, поэтому сразу после вызова `sendMessage` функция `lastBotMessage()` возвращает актуальный ID отправленного сообщения
- **Асинхронно** (по умолчанию) - библиотека не ждёт ответа от сервера и получит его в следующем `tick()`, т.е. `lastBotMessage()` *не выдаст* достоверный ID сразу после отправки

Поэтому в библиотеке есть несколько условностей и особенностей:
- Принудительно отправить сообщение с ожиданием ответа (синхронно) можно поставив флаг `wait` - `sendMessage(m, true)`
- При отправке нескольких асинхронных сообщений подряд библиотека принудительно будет ждать ответ сервера для каждого предыдущего сообщения, т.е. сделает их синхронными, чтобы избежать переподключения к серверу

```cpp
fb::Message msg("hello", 1234567);
bot.sendMessage(msg);               // асинхронно
Serial.println(lastBotMessage());   // ID может быть некорректным

bot.sendMessage(msg, true);         // синхронно
// библиотека дождётся ответа от предыдущего сообщения перед отправкой нового
Serial.println(lastBotMessage());   // реальный ID
```